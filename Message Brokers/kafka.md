–û—Å–Ω–æ–≤—ã Apache Kafka

–ß—Ç–æ —Ç–∞–∫–æ–µ Apache Kafka –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?

Apache Kafka ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
–û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é.

–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Kafka:

* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –ª–æ–≥–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–æ–≤)
* –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø–ª–∞—Ç–µ–∂–∏)
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã (IoT, DevOps)
* –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–æ–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏)
* –ü–æ—Ç–æ–∫–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (—Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)

üí° Kafka –∑–∞–º–µ–Ω—è–µ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (RabbitMQ, ActiveMQ), —Ç–∞–∫ –∫–∞–∫ –ª—É—á—à–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∏ –±—ã—Å—Ç—Ä–µ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

![img.png](img.png)

-----------
–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Kafka?
Kafka ‚Äì —ç—Ç–æ pub/sub —Å–∏—Å—Ç–µ–º–∞ (Publisher/Subscriber), —Å–æ—Å—Ç–æ—è—â–∞—è –∏–∑ –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤, –±—Ä–æ–∫–µ—Ä–æ–≤ –∏ –∫–æ–Ω—Å—É–º–µ—Ä–æ–≤.

üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Kafka:
* Producer ‚Äì –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka.
* Kafka Broker ‚Äì —Ö—Ä–∞–Ω—è—Ç –∏ —É–ø—Ä–∞–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–º–∏.
* Kafka Topic  ‚Äì –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö.
* Partitions  ‚Äì –¥–µ–ª—è—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.
* Consumer ‚Äì —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Kafka.
* Consumer Groups  ‚Äì –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏.
* Zookeeper ‚Äì —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –±—Ä–æ–∫–µ—Ä—ã.

üí° –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç?

–ü—Ä–æ–¥—é—Å–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Topic.
Kafka –¥–µ–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ Partitions.
–ö–æ–Ω—Å—å—é–º–µ—Ä—ã —Å—á–∏—Ç—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–∞—Ä—Ç–∏—Ü–∏–π.
Zookeeper —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–æ–º.

üìå –í—ã–≤–æ–¥: Kafka ‚Äì —ç—Ç–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö.

----------------
**–ß—Ç–æ —Ç–∞–∫–æ–µ Kafka Broker, –∏ —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç?**

üîπ Kafka Broker ‚Äì —ç—Ç–æ —Å–µ—Ä–≤–µ—Ä Kafka, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç Broker?
* –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤.
* –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –∂—É—Ä–Ω–∞–ª (log).
* –û—Ç–¥–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º.
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é.

üí° –ü—Ä–∏–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka:

![img_1.png](img_1.png)

üìå –í—ã–≤–æ–¥: Kafka Broker ‚Äì —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö.

------------------
–ß—Ç–æ —Ç–∞–∫–æ–µ Kafka Topic, –∏ –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç?

üîπ Kafka Topic ‚Äì —ç—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–∞–Ω–∞–ª –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Kafka Topic?
* Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Topic.
* Partitioning –¥–µ–ª–∏—Ç Topic –Ω–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.
* Consumer Groups —á–∏—Ç–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–∞—Ä—Ç–∏—Ü–∏–π.

üí° –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è Topic:

>sh\
>kafka-topics.sh --create --topic user_events --bootstrap-server kafka1:9092 --partitions 3 --replication-factor 2

üìå –í—ã–≤–æ–¥: Kafka Topic ‚Äì —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

------------
**–ß—Ç–æ —Ç–∞–∫–æ–µ Partitioning (–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) –∏ –∑–∞—á–µ–º –æ–Ω–æ –Ω—É–∂–Ω–æ?**
üîπ Partitioning ‚Äì —ç—Ç–æ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã (–ø–∞—Ä—Ç–∏—Ü–∏–∏) –≤–Ω—É—Ç—Ä–∏ Kafka Topic.
‚úÖ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚Üí –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±—Ä–æ–∫–µ—Ä–µ.

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Üí –î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

–ì–∏–±–∫–æ—Å—Ç—å ‚Üí –†–∞–∑–Ω—ã–µ –∫–æ–Ω—Å—å—é–º–µ—Ä—ã –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

üìå –í—ã–≤–æ–¥: –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–∫–æ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å Kafka.

-----------------------------
**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Offset Management?**
üîπ Offset ‚Äì —ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏.
‚úÖ –ö–∞–∫ Kafka —É–ø—Ä–∞–≤–ª—è–µ—Ç Offset?

Kafka Offset ‚Äì —ç—Ç–æ –ø–æ–∑–∏—Ü–∏—è —á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.
–ö–æ–Ω—Å—å—é–º–µ—Ä –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç Offset, —á—Ç–æ–±—ã –Ω–µ —á–∏—Ç–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ.
Offset –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ Zookeeper –∏–ª–∏ Kafka (Kafka Consumer API).
üí° –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å Offset:

>from kafka import KafkaConsumer\
>\
>consumer = KafkaConsumer('user_events',\
                         group_id='analytics_team',\
                         bootstrap_servers=['kafka1:9092'])
>
>for message in consumer:\
    print(f"Received: {message.value} with offset {message.offset}")

üìå –í—ã–≤–æ–¥: Offset —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫–æ–º –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ.

--------------------
**–ß—Ç–æ —Ç–∞–∫–æ–µ Consumer Groups –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?**

üîπ Consumer Group ‚Äì —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏—Ö –æ–¥–∏–Ω Topic –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
‚úÖ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ ‚Äì —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Å—å—é–º–µ—Ä—ã —á–∏—Ç–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏.

–ì–∏–±–∫–æ—Å—Ç—å ‚Äì –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤.

–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚Äì Kafka –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.



![img_2.png](img_2.png)sql

üìå –í—ã–≤–æ–¥: Consumer Groups –ø–æ–∑–≤–æ–ª—è—é—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö.

--------------
**–ö–∞–∫ Kafka –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å?**

üîπ Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –∏ Zookeeper.

‚úÖ –ú–µ—Ö–∞–Ω–∏–∑–º—ã –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏:

–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π ‚Üí –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –∏–º–µ–µ—Ç –ª–∏–¥–µ—Ä–∞ –∏ —Ä–µ–ø–ª–∏–∫–∏.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Üí –ü—Ä–∏ —Å–±–æ–µ –ª–∏–¥–µ—Ä –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –Ω–æ–¥—É.

Zookeeper –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞.

üìå –í—ã–≤–æ–¥: Kafka –æ—Å—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ–π –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ—è—Ö.

-------------
**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –ª–∏–¥–µ—Ä—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π?**

üîπ Kafka –∫–æ–ø–∏—Ä—É–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –∏–º–µ–µ—Ç –ª–∏–¥–µ—Ä–∞ (Leader) –∏ —Ä–µ–ø–ª–∏–∫–∏ (Followers).

–¢–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã.

–ï—Å–ª–∏ –±—Ä–æ–∫–µ—Ä —Å –ª–∏–¥–µ—Ä–æ–º —É–ø–∞–ª, –Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å—Ä–µ–¥–∏ —Ä–µ–ø–ª–∏–∫.

![img_3.png](img_3.png)

üìå –í—ã–≤–æ–¥: –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

-------------
**–ß—Ç–æ —Ç–∞–∫–æ–µ ISR (In-Sync Replicas) –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?**

üîπ ISR ‚Äì —ç—Ç–æ —Å–ø–∏—Å–æ–∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö) —Ä–µ–ø–ª–∏–∫ –ø–∞—Ä—Ç–∏—Ü–∏–∏.

–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

ISR —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∏.

Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ISR –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞ –ø—Ä–∏ —Å–±–æ—è—Ö.

üìå –í—ã–≤–æ–¥: ISR –∑–∞—â–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ—Ç–µ—Ä–∏.

------------------
10. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Zookeeper –≤ Kafka?
üîπ Zookeeper —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ Kafka.
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç Zookeeper?

–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—Ä–æ–∫–µ—Ä–æ–≤.

–í—ã–±–∏—Ä–∞–µ—Ç –ª–∏–¥–µ—Ä–æ–≤ –ø–∞—Ä—Ç–∏—Ü–∏–π.

–•—Ä–∞–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

üìå –í—ã–≤–æ–¥: Zookeeper ‚Äì —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä Kafka.

-----------------
**–ö–∞–∫ Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π?**

üîπ Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏.

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–°–æ–æ–±—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å—Ç—Ä–æ–≥–æ –≤ –ø–æ—Ä—è–¥–∫–µ.

–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –º–Ω–æ–≥–æ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Partition Key.

üìå –í—ã–≤–æ–¥: –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏.

--------------------
**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –±—Ä–æ–∫–µ—Ä–∞ Kafka?**

–ï—Å–ª–∏ –±—Ä–æ–∫–µ—Ä –ø–∞–¥–∞–µ—Ç:

–ü–∞—Ä—Ç–∏—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –±—Ä–æ–∫–µ—Ä—ã.

Zookeeper –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞.

–ö–æ–Ω—Å—å—é–º–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

üìå –í—ã–≤–æ–¥: Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–∫–∞–∑–∞.

------------------
**–ö–∞–∫ Kafka –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è?**

üîπ Kafka –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è, –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ –±—Ä–æ–∫–µ—Ä—ã.

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –±—Ä–æ–∫–µ—Ä—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä.

–ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞—Ä—Ç–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ kafka-reassign-partitions.sh.

–ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ–º –Ω–∞–≥—Ä—É–∑–∫—É.

üìå –í—ã–≤–æ–¥: Kafka –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ.

--------------------

# –†–∞–±–æ—Ç–∞ —Å Producer 

**–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Kafka?**

–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Kafka Producer API. Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ç–æ–ø–∏–∫ (topic), –∏ Kafka —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Ö –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º.

–ü—Ä–æ—Å—Ç–µ–π—à–∏–π Producer –Ω–∞ Python:

>from kafka import KafkaProducer
>\
producer = KafkaProducer(bootstrap_servers='localhost:9092')\
producer.send('my-topic', b'Hello, Kafka!')\
producer.flush()


bootstrap_servers ‚Äî –∞–¥—Ä–µ—Å–∞ Kafka-–±—Ä–æ–∫–µ—Ä–æ–≤

send('my-topic', b'Hello, Kafka!') ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫

flush() ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

----------
**–ö–∞–∫–∏–µ —Ä–µ–∂–∏–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –µ—Å—Ç—å —É Producer?**

Kafka –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:

* Fire and Forget ‚Äî Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –Ω–µ –∂–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
* Synchronous Send (ACKS) ‚Äî Producer –∂–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –±—Ä–æ–∫–µ—Ä–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
* Asynchronous Send (Callback) ‚Äî Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–ª–ª–±–µ–∫, –∫–æ–≥–¥–∞ –±—Ä–æ–∫–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç –ø—Ä–∏–µ–º.
-----
**Fire and Forget**

Producer –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Kafka –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –≠—Ç–æ—Ç —Å–ø–æ—Å–æ–± —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –ø–æ—Ç–µ—Ä–µ —Å–æ–æ–±—â–µ–Ω–∏–π.

> producer.send('my-topic', b'Fast message!')

–ü–ª—é—Å—ã: –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

–ú–∏–Ω—É—Å—ã: –≤–æ–∑–º–æ–∂–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ —Å–±–æ—è—Ö

----
Synchronous Send (ACKS)

Producer –∂–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –±—Ä–æ–∫–µ—Ä–∞, –ø—Ä–µ–∂–¥–µ —á–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.


future = producer.send('my-topic', b'Synchronous message')
result = future.get()  # –î–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
print(result)

–ü–ª—é—Å—ã: —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è

–ú–∏–Ω—É—Å—ã: –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º Fire and Forget

---
Asynchronous Send (Callback)
–ü–æ–∑–≤–æ–ª—è–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.

def on_send_success(record_metadata):
    print(f"Message sent to {record_metadata.topic} on partition {record_metadata.partition}")

def on_send_error(ex):
    print(f"Error: {ex}")

producer.send('my-topic', b'Async message').add_callback(on_send_success).add_errback(on_send_error)

–ü–ª—é—Å—ã: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ú–∏–Ω—É—Å—ã: —Å–ª–æ–∂–Ω–µ–µ –≤ –æ—Ç–ª–∞–¥–∫–µ

--------------
–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Kafka Producer API?

* KafkaProducer ‚Äî —Å–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä Producer
* send(topic, value) ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
* flush() ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
* close() ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç Producer
* acks ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏

-----------------
–ß—Ç–æ —Ç–∞–∫–æ–µ ACKS (Acknowledgment Mode)?

ACKS (Acknowledgment Mode) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Kafka.

![img_5.png](img_5.png)

Producer –Ω–µ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Kafka, –∞ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.

> producer = KafkaProducer(bootstrap_servers='localhost:9092', acks=0)

–°–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç —Ç–µ—Ä—è—Ç—å—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö –±—Ä–æ–∫–µ—Ä–∞.

![img_6.png](img_6.png)

-----------
**–ö–∞–∫ Producer –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π?**

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ acks=all
* –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (retries > 0)
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–≥–æ Producer'–∞
* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (Keyed Partitioner)

--------------
**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Keyed Partitioner?**

Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∫–ª—é—á–æ–º –ø–æ–ø–∞–¥—É—Ç –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é.

> producer.send('my-topic', key=b'123', value=b'Important message')

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å key=123 –ø–æ–ø–∞–¥—É—Ç –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é.

--------------
**–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Producer –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?**

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É (acks=1)

–£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä batch'–µ–π (batch.size)

–í–∫–ª—é—á–∏—Ç—å —Å–∂–∞—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π (compression.type=lz4)

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (retries=3)

> producer = KafkaProducer(\
    bootstrap_servers='localhost:9092',\
    compression_type='lz4',\
    batch_size=16384,\
    linger_ms=10
)

------
# –†–∞–±–æ—Ç–∞ —Å Consumer (–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π)

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Kafka Consumer API?

Kafka Consumer —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–æ–ø–∏–∫–∞ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö.

> from kafka import KafkaConsumer\
> consumer = KafkaConsumer('my-topic', bootstrap_servers='localhost:9092', auto_offset_reset='earliest')/
for message in consumer:/
    print(f"Received: {message.value}")/

-----
**–ß—Ç–æ —Ç–∞–∫–æ–µ Offset Management –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?**

Offset ‚Äî —ç—Ç–æ –ø–æ–∑–∏—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏.

Kafka –Ω–µ —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ä–∞–∑—É ‚Äî Consumer —Å–∞–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç Offset.

![img_7.png](img_7.png)

----------
**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Consumer Group –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏?**

Consumer Group ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —á–∏—Ç–∞—é—Ç –¥–∞–Ω–Ω—ã–µ.

Kafka —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–µ–∂–¥—É Consumer'–∞–º–∏ –≤ –≥—Ä—É–ø–ø–µ.

–ï—Å–ª–∏ Consumer –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å—Ç—Ä–æ—è, –µ–≥–æ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è.

-------
**–ß—Ç–æ —Ç–∞–∫–æ–µ Commit Offset –∏ –∫–∞–∫–∏–µ –µ—Å—Ç—å —Ä–µ–∂–∏–º—ã?**

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π commit (enable.auto.commit=true)
> consumer = KafkaConsumer('my-topic', bootstrap_servers='localhost:9092', enable_auto_commit=True)
> 
–ù–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç offset –≤—Ä—É—á–Ω—É—é.

–†—É—á–Ω–æ–π commit (commitSync() –∏ commitAsync())
consumer.commitSync()  # –ñ–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç Kafka
consumer.commitAsync()  # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π commit

–ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å offset'—ã –≤—Ä—É—á–Ω—É—é.

-----------------
**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ Consumer'–∞ (Backpressure handling)?**

–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (max.poll.records)

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ (max.poll.interval.ms)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π